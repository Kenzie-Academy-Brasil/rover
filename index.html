<html>
<head>
<meta charset="utf-8">
<title>Kenzie Academy - Rover Tutorial</title>
<style>
body {font-family: sans-serif; font-weight: 300; margin: 0;}
textarea {font-family: monospace; font-size: 16px;}
.grayable:read-only {color: #888; background: #eee;}
#banner {background: #211b17; color: white; padding: 20px;}
#content {width: 700px; margin: 0 auto;}
#logo {width: 90px; height: 90px;}
#headline {position: absolute; left: 130px; top: 45px; font-size: 40px; font-weight: bold;}
.program {width: 290px; display: block; float: left; position: relative;}
.check {width: 128px; height: 128px; background-image: url('check.png'); background-size: 128px 128px; position: absolute; left: 160px; top: 80px; display: none;}
button {font-size: 24px; cursor: pointer;}
.reset {display: none;}
.map {width: 350px; background-image: url('floorplan2.jpg'); background-position: -105px -150px; border: 2px solid black; display: block; margin-top: 20px; float: left; position: relative;}
.rover {width: 50px; height: 50px; background-image: url('rover.png'); background-size: 50px 50px; position: relative;}
.fire {width: 64px; height: 64px; background-image: url('fire.gif'); background-size: 64px 64px; position: relative; left: -7px; top: -17px; display: none;}
#crashexplanation {display: none; background: #ffaaaa; border: 2px solid black; padding: 30px; font-weight: bold;}
#password {display: none; position: absolute; left: 310px; top: 40px; background: #eee; border: 2px solid black; padding: 30px; width: 240px; height: 150px; font-weight: bold; z-index: 5;}
.trash {width: 45px; height: 45px; background-image: url('trash.png'); background-size: 45px 45px; position: absolute;}
.clear {margin-bottom: 50px; clear: both;}
.blue {color: blue; font-family:'Courier New', Courier, monospace; font-size: larger;}
</style>
<script src="jquery-3.2.1.min.js"></script>
</head>
<body>
<header id="banner">
<img src="logo.png" id="logo" alt="Kenzie Academy">
<div id="headline">Rover Tutorial</div>
</header>

<div id="content">

<div id="introduction">
<h2>Introdução ao Rover</h3>
Neste tutorial, você aprenderá a escrever programas para controlar o novo Robot Vacuum da Kenzie Brasil, apelidado de Rover.<br/>
<br/>
Esse é o Rover: <div class="rover" style="display: inline-block; vertical-align: middle;"></div><br/>
<br/>
Seus programas serão uma série de instruções passo a passo que orientam o Rover a se mover.<br/>
<br/>
O primeiro comando que você usará é <code>forward();</code>, que instrui o Rover a dar um passo à frente.<br/>
Vamos começar com um programa simples que apenas emite o <code>forward();</code> duas vezes.<br/>
Clique no botão "Run" para ver o Rover executando este programa.
</div>
<div class="program">
<h4>Rover's Program:</h4>
<div id="check1" class="check"></div>
<textarea id="code1" rows="4" cols="14"  readonly>
forward();
forward();
</textarea>
<br/>
<button id="run1" onclick="run1();">Run</button>
<button id="reset1" class="reset" onclick="run1(true);">Reset</button>
</div>
<div style="height: 150px; background-position: -105px -250px;" class="map"><div id="rover1" class="rover" style="left: 30px; top: 60px;"></div></div>
<div class="clear"></div>

<div id="movingforward">
<h2>Andando para frente</h2>
Isso é um pedaço de lixo: <div class="trash" style="display: inline-block; position: relative; top: 10px;"></div><br/>
<br/>
Modifique o programa do Rover abaixo fazendo ele dar três passos à frente para que ele possa coletar o lixo.<br/>
Em seguida, clique no botão "Run" para ver o Rover executando este programa.
</div>
<div class="program">
<h4>Rover's Program:</h4>
<div id="check2" class="check"></div>
<textarea id="code2" rows="4" cols="14" class="grayable">
forward();
forward();
</textarea>
<br/>
<button id="run2" onclick="run2();">Run</button>
<button id="reset2" class="reset" onclick="run2(true);">Reset</button>
</div>
<div style="height: 150px; background-position: -105px -250px;" class="map">
<div id="rover2" class="rover" style="left: 30px; top: 60px;"></div>
<div id="garbage230" class="trash" style="left: 200px; top: 60px;"></div>
</div>
<div class="clear"></div>


<div id="crashing">
<h2>Se acidentando</h2>
Escreva um programa abaixo para fazer a Rover dar 4 passos à frente.<br/>
Em seguida, clique no botão "Run" para ver o que acontece quando o Rover bate em uma parede ou obstáculo.
</div>
<div class="program">
<h4>Rover's Program:</h4>
<div id="check3" class="check"></div>
<textarea id="code3" rows="5" cols="14" class="grayable">
</textarea>
<br/>
<button id="run3" onclick="run3();">Run</button>
<button id="reset3" class="reset" onclick="run3(true);">Reset</button>
</div>
<div style="height: 150px; background-position: -105px -250px;" class="map"><div id="rover3" class="rover" style="left: 30px; top: 60px;"><div class="fire"></div></div></div>
<div class="clear"></div>
<div id="crashexplanation">
Esse acidente nos mostra que o Rover é bem frágil!<br/>
Se o Rover bate em uma parede ou um obstáculo, ele para de se mover e pega fogo.	
</div>
<div class="clear"></div>

<div id="turning">
<h2>Virando</h2>
Os comandos <code>right();</code> and <code>left();</code> fazem o Rover girar 90 graus, sendo o right para a direita e left para esquerda.<br/>
<br/>
Escreva um programa que especifique uma série de comandos com <code>forward();</code>, <code>left();</code>, and <code>right();</code>
para que o Rover recolha todos os pedaços de lixo sem bater em nenhum obstáculo.
</div>
<div class="program">
<h4>Rover's Program:</h4>
<div id="check4" class="check"></div>
<textarea id="code4" rows="15" cols="14" class="grayable">
</textarea>
<br/>
<button id="run4" onclick="run4();">Run</button>
<button id="reset4" class="reset" onclick="run4(true);">Reset</button>
</div>
<div style="height: 350px;" class="map">
<div id="rover4" class="rover" style="left: 30px; top: 58px;"><div class="fire"></div></div>
<div id="garbage413" class="trash" style="left: 90px; top: 220px;"></div>
<div id="garbage430" class="trash" style="left: 205px; top: 60px;"></div>
</div>
<div class="clear"></div>


<div id="parameters">
<h2>Incluindo parâmetros</h2>
Nos exercícios anteriores, quando você quer fazer o Rover dar vários passos à frente, você precisa repetir o comando <code>forward();</code>
Agora você aprenderá uma maneira de evitar isso, passando um parâmetro junto com o comando.<br/>
<br/>
Para fazer o Rover dar vários passos à frente, você pode escrever um comando como <code>forward(3);</code>, que instrui o Rover a dar três passos à frente. O número entre parênteses é o que chamamos de parâmetro. <em>parameter</em>.<br/>
<br/>
Escreva um programa que instrua o Rover a pegar todos os pedaços de lixo e execute-o.
</div>
<div class="program">
<h4>Rover's Program:</h4>
<div id="check5" class="check"></div>
<div id="password">
	<p>
		Parabéns!
	</p>
	<p>
		Você programou com sucesso o Rover para pegar todos os pedaços de lixo.
	</p>
	<p>
		Rover: "<span class="blue">Tudo Limpo!</span>"
	</p>
</div>
<textarea id="code5" rows="15" cols="14" class="grayable">
</textarea>
<br/>
<button id="run5" onclick="run5();">Run</button>
<button id="reset5" class="reset" onclick="run5(true);">Reset</button>
</div>
<div style="height: 350px;" class="map">
<div id="rover5" class="rover" style="left: 30px; top: 58px;"><div class="fire"></div></div>
<div id="garbage513" class="trash" style="left: 90px; top: 220px;"></div>
<div id="garbage530" class="trash" style="left: 205px; top: 60px;"></div>
</div>

<div class="clear"></div>

<script>
//var rover;
var open;
var garbage, garbageCollected;
var problem;
var x, y;
var d;

if ( window.location !== window.parent.location ) {
  $("#banner").hide();
}

function run1(reset) {
	problem = 1;
	rover = $("#rover1");
	rover.stop(true);
	rover.css({"left": "30px", "top": "60px", "transform": "none", "textIndent": 0});
	open = "00,10,20,30";
	garbage=[];
	garbageCollected=[];
	x=0;
	y=0;
	d=1;
	if(reset == true) {
		$("#check1").hide();
		$("#reset1").hide();
		$("#run1").show();
	} else {
		$("#run1").hide();
		//$("#reset1").show();
		crashed = false;
		forward(2);
		setTimeout(function() {
			$("#check1").fadeIn();
		}, 1000);
	}
}

function run2(reset) {
	problem = 2;
	rover = $("#rover2");
	rover.stop(true);
	rover.css({"left": "30px", "top": "60px", "transform": "none", "textIndent": 0});
	open = "00,10,20,30";
	garbage=["30"];
	garbageCollected=[];
	x=0;
	y=0;
	d=1;
	if(reset == true) {
		$("#check2").hide();
		$("#reset2").hide();
		$("#run2").show();
		$("#garbage230").show();
		$("#code2").attr("readonly",false);
	} else {
		var str = $("#code2").val().replace(/\s/g,'');
		if(str.includes(":")) {
			alert("Note que ; e : são caracteres diferentes.\nOs comandos do Rover nunca utilizam o caracter : \nTenha certeza que você use somente ; no final de cada comando.");
			return;
		}
		if(str.toLowerCase()!=str) {
			alert("Todos os comandos do Rover devem ser escritos somente com letras minúsculas.\nRemova qualquer letra maiúscula dos comandos do Rover.");
			return;
		}
		if(str!="forward();forward();forward();") {
			alert("Para esse exercício, repita o comando forward(); exatamente 3 vezes.");
			return;
		}
		$("#code2").attr("readonly",true);
		$("#run2").hide();
		$("#reset2").show();
		crashed = false;
		forward(3);
		setTimeout(function() {
			$("#check2").fadeIn();
		}, 1400);
	}
}

function run3(reset) {
	problem = 3;
	rover = $("#rover3");
	rover.stop(true);
	rover.css({"left": "30px", "top": "60px", "transform": "none", "textIndent": 0});
	rover.children(".fire").hide();
	open = "00,10,20,30";
	garbage=[];
	garbageCollected=[];
	x=0;
	y=0;
	d=1;
	if(reset == true) {
		$("#check3").hide();
		$("#reset3").hide();
		$("#run3").show();
		$("#code3").attr("readonly",false);
	} else {
		var str = $("#code3").val().replace(/\s/g,'');
		if(str.includes(":")) {
			alert("Note que ; e : são caracteres diferentes.\nOs comandos do Rover nunca utilizam o caracter : \nTenha certeza que você use somente ; no final de cada comando.");
			return;
		}
		if(str.toLowerCase()!=str) {
			alert("Todos os comandos do Rover devem ser escritos somente com letras minúsculas.\nRemova qualquer letra maiúscula dos comandos do Rover.");
			return;
		}
		if(str!="forward();forward();forward();forward();") {
			alert("Para esse exercício, repita o comando forward(); exatamente 4 vezes.");
			return;
		}
		$("#code3").attr("readonly",true);
		$("#run3").hide();
		$("#reset3").show();
		crashed = false;
		forward(4);
		setTimeout(function() {
			$("#crashexplanation").slideDown(1200);
			$("#check3").fadeIn();
		}, 1800);
	}
}


function run4(reset) {
	problem = 4;
	rover = $("#rover4");
	rover.stop(true);
	rover.css({"left": "30px", "top": "58px", "transform": "none", "textIndent": 0});
	rover.children(".fire").hide();
	open =  "00,      30,"+
			"01,      31,"+
			"02,12,22,32,"+
			   "13,23,33";
	garbage=["13", "30"];
	garbageCollected=[];
	x=0;
	y=0;
	d=1;
	if(reset == true) {
		$("#check4").hide();
		$("#password").hide();
		$("#reset4").hide();
		$("#run4").show();
		$("#garbage430").show();
		$("#garbage413").show();
		$("#code4").attr("readonly",false);
	} else {
		var str = $("#code4").val();
		if(str.includes(":")) {
			alert("Note que ; e : são caracteres diferentes.\nOs comandos do Rover nunca utilizam o caracter : \nTenha certeza que você use somente ; no final de cada comando.");
			return;
		}
		if(str.toLowerCase()!=str) {
			alert("Todos os comandos do Rover devem ser escritos somente com letras minúsculas.\nRemova qualquer letra maiúscula dos comandos do Rover.");
			return;
		}
		$("#code4").attr("readonly",true);
		$("#run4").hide();
		$("#reset4").show();
		crashed = false;
		eval(str);
		if(garbageCollected.length == 2) {
			rover.queue(function() {
				$("#check4").fadeIn();
			});
		}
	}
}


function run5(reset) {
	problem = 5;
	rover = $("#rover5");
	rover.stop(true);
	rover.css({"left": "30px", "top": "58px", "transform": "none", "textIndent": 0});
	rover.children(".fire").hide();
	open =  "00,      30,"+
			"01,      31,"+
			"02,12,22,32,"+
			   "13,23,33";
	garbage=["13", "30"];
	garbageCollected=[];
	x=0;
	y=0;
	d=1;
	if(reset == true) {
		$("#check5").hide();
		$("#reset5").hide();
		$("#password").hide();
		$("#run5").show();
		$("#garbage530").show();
		$("#garbage513").show();
		$("#code5").attr("readonly",false);
	} else {
		var str = $("#code5").val().replace(/\s/g,'');
		//validation
		if(str.includes(":")) {
			alert("Note que ; e : são caracteres diferentes.\nOs comandos do Rover nunca utilizam o caracter : \nTenha certeza que você use somente ; no final de cada comando.");
			return;
		}
		if(str.toLowerCase()!=str) {
			alert("Todos os comandos do Rover devem ser escritos somente com letras minúsculas.\nRemova qualquer letra maiúscula dos comandos do Rover.");
			return;
		}
		if(str.includes("forward();forward();")) {
			alert("Ao invés de dar ao Rover vários comandos forward();, passe um parâmetro especificando quantos passos o Rover deve avançar, como forward(2); forward(3);");
			return;
		}
		$("#code5").attr("readonly",true);
		$("#run5").hide();
		$("#reset5").show();
		crashed = false;
		eval(str);
		if(garbageCollected.length == 2) {
			rover.queue(function() {
				$("#check5").fadeIn();
				$("#password").fadeIn();
			});
		}
	}
}

function crash(dx,dy) {
	crashed = true;
	rover.animate({"left": "+="+dx, "top": "+="+dy},
		{"complete": function(){
			rover.children(".fire").fadeIn();
		}
	});
}

var crashed = false;

function forward(steps) {
	if(crashed) return;
	if (steps === undefined) steps = 1;
	var dx=0, dy=0;
	switch(d) {
		case 0: dy=-1; break;
		case 1: dx=1; break;
		case 2: dy=1; break;
		case 3: dx=-1; break;
	}
	x += dx;
	y += dy;
	var squareLabel = ""+x+""+y;
	if(x<0 || y<0 || !open.includes(squareLabel)) {
		crash(dx*12,dy*12);
		return;
	}
	var params = {};
	if(garbage.indexOf(squareLabel)>=0 && garbageCollected.indexOf(squareLabel)==-1) {
		// animate disappearing garbage
		params =
			{"start": function() {
				$("#garbage"+problem+""+squareLabel).fadeOut();
			}
		};
		garbageCollected.push(squareLabel);
	}
	var sdx = dx*57, sdy = dy*55;
	rover.animate({"left": "+="+sdx, "top": "+="+sdy}, params);
	if(steps>1)
		forward(steps-1);
}

function left(steps) {
	if(crashed) return;
	if (steps === undefined) steps = 1;
	d = (d + 3) % 4;
	//rover.css({"transform": "rotate("+(d-1)*90+"deg)"});
	if(d==3) {
		rover.animate({"textIndent": 270}, 1);
	}
	rover.animate({ "textIndent": (d-1)*90 }, {
		step: function(value) {
			$(this).css('transform','rotate('+value+'deg)');
		},
		duration: 500
	});
	if(steps>1)
		left(steps-1);
}

function right(steps) {
	if(crashed) return;
	if (steps === undefined) steps = 1;
	d = (d + 1) % 4;
	//rover.css({"transform": "rotate("+(d-1)*90+"deg)"});
	var deg = (d-1)*90;
	if(d==0) {
		rover.animate({"textIndent": -180}, 1);
	}
	rover.animate({ "textIndent": deg }, {
		step: function(value) {
			$(this).css('transform','rotate('+value+'deg)');
		},
		duration: 500
	});
	if(steps>1)
		right(steps-1);
}
// todo
// basic validation for 4 and 5
</script>

</body>
</html>
